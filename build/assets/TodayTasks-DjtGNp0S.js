import{r as n,j as e,L as y,R as C}from"./index-DgYjAzAV.js";import{d as g}from"./index-DEavITLk.js";import{h as S,m as N,i as w}from"./api-CbhHiXfZ.js";import{C as T}from"./CCol-CupnGcp2.js";import{C as k,a as D}from"./CCardBody-beKhoL1g.js";import{C as v}from"./CCardHeader-CwEME8B9.js";import{a as h}from"./CButton-Ds9Im62X.js";const $=()=>{const[c,d]=n.useState([]),[j,f]=n.useState(!0),[p,b]=n.useState(null);n.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("Authentication token is missing.");const o=await S(s);if(o&&o.data)d(o.data);else throw new Error("No tasks found.")}catch(s){b(s.message),console.error("Error fetching tasks:",s)}finally{f(!1)}})()},[]);const u=async(t,s=null)=>{try{const o=localStorage.getItem("token");if(!o)throw new Error("Authentication token is missing.");if(s){const m=await N(o,t,s);m&&m.data&&(alert("Subtask marked as complete"),d(x=>x.map(r=>{if(r._id===t){const i=r.subtasks.map(l=>(l._id===s&&(l.completed=!0),l)),a=i.every(l=>l.completed);return r.status=a?"completed":"pending",{...r,subtasks:i}}return r})))}else if(c.find(r=>r._id===t).subtasks.every(r=>r.completed)){const r=await w(o,t);r&&r.data&&(alert("Task marked as complete"),d(i=>i.map(a=>(a._id===t&&(a.status="completed",a.subtasks=a.subtasks.map(l=>({...l,completed:!0}))),a))))}else alert("All subtasks must be completed before marking the task as complete.")}catch(o){console.error("Error marking task or subtask as complete:",o),alert("Failed to mark task or subtask as complete")}};return j?e.jsx("p",{children:"Loading..."}):p?e.jsxs("p",{children:["Error: ",p]}):e.jsx(T,{xs:12,children:e.jsxs(k,{className:"mb-4",style:{border:"1px solid #ddd",borderRadius:"10px"},children:[e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("strong",{className:"fs-4",children:"Today's Tasks"})}),e.jsx(h,{color:"primary",variant:"outline",className:"me-3",children:e.jsx(y,{to:"/view-all-tasks",style:{textDecoration:"none"},children:"View All Tasks"})})]}),e.jsx(D,{children:e.jsx("div",{className:"mt-3",children:c.length>0?e.jsxs("table",{className:"table table-striped table-bordered table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("th",{scope:"col",children:"Project Name"}),e.jsx("th",{scope:"col",children:"Task Title"}),e.jsx("th",{scope:"col",children:"Due Date"}),e.jsx("th",{scope:"col",children:"Priority"}),e.jsx("th",{scope:"col",children:"Status"}),e.jsx("th",{scope:"col",children:"Action"})]})}),e.jsx("tbody",{children:c.map(t=>e.jsxs(C.Fragment,{children:[e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("td",{style:{fontWeight:"bold"},children:t.board.title}),e.jsx("td",{children:e.jsx("span",{style:{textDecoration:t.status==="completed"?"line-through":"none"},children:t.title})}),e.jsx("td",{children:t.dueDate?new Date(t.dueDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Not Set"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.priority==="high"?"bg-danger":t.priority==="medium"?"bg-warning":"bg-success"}`,children:t.priority.charAt(0).toUpperCase()+t.priority.slice(1)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.status==="completed"?"bg-success":"bg-danger"}`,children:t.status})}),e.jsx("td",{children:t.status!=="completed"&&e.jsxs(h,{size:"sm",color:"success",variant:"outline",onClick:()=>u(t._id),disabled:t.subtasks.some(s=>!s.completed),children:[e.jsx(g,{})," Mark as Complete"]})})]}),t.subtasks&&t.subtasks.length>0&&t.subtasks.map((s,o)=>e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("td",{colSpan:"2",className:"ps-5",children:e.jsx("span",{style:{textDecoration:s.completed?"line-through":"none"},children:s.title})}),e.jsx("td",{children:s.dueDate?new Date(s.dueDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Not Set"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.priority==="high"?"bg-danger":s.priority==="medium"?"bg-warning":"bg-success"}`,children:s.priority.charAt(0).toUpperCase()+s.priority.slice(1)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.completed?"bg-success":"bg-danger"}`,children:s.completed?"Completed":"Pending"})}),e.jsx("td",{children:s.completed!==!0&&e.jsxs(h,{size:"sm",color:"success",variant:"outline",onClick:()=>u(t._id,s._id),children:[e.jsx(g,{})," Mark as Complete"]})})]},o))]},t._id))})]}):e.jsx("p",{children:"No tasks available for today"})})})]})})};export{$ as default};
