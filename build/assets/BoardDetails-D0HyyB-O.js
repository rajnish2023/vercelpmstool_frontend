import{r,q as R,j as e}from"./index-DgYjAzAV.js";import{q as f,y as $,b as B}from"./api-CbhHiXfZ.js";import{D as F,H as T,u as N,a as I,C as M}from"./index-CNv7VeAx.js";import{e as W,f as z,b as P}from"./index-DEavITLk.js";import{C as q,a as H}from"./CCardBody-beKhoL1g.js";import{a as x}from"./CButton-Ds9Im62X.js";import{C as X,a as Y,b as G,c as J}from"./CModalHeader-C23ycL_x.js";import{C as j}from"./CFormControlWrapper-CjE6UTdE.js";import{C as v}from"./CFormInput-oMjOEnwC.js";import"./CConditionalPortal-DsNRDAW1.js";const C="http://localhost:5000/api/board",de=()=>{const[t,h]=r.useState([]),[c,g]=r.useState(""),[p,n]=r.useState(!1),{slug:a}=R();console.log(a);const l=async()=>{try{const d=await $(a);h(d.board)}catch(d){console.error("Error fetching boards:",d)}},u=async d=>{try{await f.post(`${C}/boards/${d}/lists`,{title:c}),g(""),n(!1),l()}catch(m){console.error("Error creating list:",m)}},o=async(d,m,S,b)=>{try{await f.post(`${C}/boards/${d}/lists/${m}/cards/${b}/move`,{targetListId:S}),l()}catch(y){console.error("Error moving card:",y)}};return r.useEffect(()=>{l()},[]),e.jsx(F,{backend:T,children:e.jsx("div",{style:{padding:"20px",backgroundColor:"#f8f9fa"},children:e.jsx("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap"},children:e.jsx(q,{className:"mb-4",style:{width:"100%",backgroundColor:"#fff",borderRadius:"10px",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.1)"},children:e.jsx(H,{children:e.jsxs("div",{style:{display:"flex",overflowX:"auto",gap:"15px"},children:[t&&t.lists&&t.lists.length>0?t.lists.map(d=>e.jsx(K,{list:d,boardId:t._id,moveCard:o},d._id)):e.jsx("div",{children:"No lists available"}),e.jsx("div",{children:p?e.jsxs("div",{style:{padding:"15px",minWidth:"250px",maxWidth:"300px",backgroundColor:"#f4f5f7",borderRadius:"5px"},children:[e.jsx("input",{type:"text",value:c,onChange:d=>g(d.target.value),placeholder:"List Title",style:{padding:"8px",fontSize:"14px",width:"100%",marginBottom:"10px",borderRadius:"5px",border:"1px solid #ddd"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(x,{onClick:()=>u(t._id),color:"primary",children:"Add List"}),e.jsx(x,{onClick:()=>n(!1),color:"danger",children:"Cancel"})]})]}):e.jsx(x,{onClick:()=>n(!0),color:"secondary",style:{minWidth:"190px",maxWidth:"190px",padding:"7px",textAlign:"center",backgroundColor:"#007bff",border:"1px transparent",borderRadius:"5px"},children:"Add Another List"})})]})})},t._id)})})})},K=({list:t,boardId:h,moveCard:c})=>{const[g,p]=r.useState(!1),[n,a]=r.useState(""),l=async()=>{if(n.trim())try{await f.post(`${C}/boards/${h}/lists/${t._id}/cards`,{title:n}),a(""),p(!1)}catch(o){console.error("Error adding card:",o)}},[,u]=N({accept:"CARD",drop:o=>{o.sourceListId!==t._id&&c(h,o.sourceListId,t._id,o.cardId)}});return e.jsxs("div",{ref:u,style:{backgroundColor:"#f4f5f7",padding:"15px",borderRadius:"5px",minWidth:"300px",maxWidth:"300px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h6",{style:{marginBottom:"10px"},children:t.title}),e.jsxs("div",{children:[t.cards.map(o=>e.jsx(O,{card:o,boardId:h,listId:t._id,moveCard:c},o._id)),!g&&e.jsx(x,{onClick:()=>p(!0),style:{marginTop:"10px",padding:"8px 16px",fontSize:"14px",fontWeight:"bold"},children:"Add a Card"}),g&&e.jsxs("div",{children:[e.jsx("input",{type:"text",value:n,onChange:o=>a(o.target.value),placeholder:"Card Title",style:{padding:"8px",width:"100%",marginBottom:"10px",borderRadius:"5px",border:"1px solid #ddd"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(x,{onClick:l,color:"primary",children:"Add"}),e.jsx(x,{onClick:()=>p(!1),color:"danger",children:"Cancel"})]})]})]})]})},O=({card:t,boardId:h,listId:c,moveCard:g})=>{const[p,n]=r.useState(!1),[a,l]=r.useState({title:t.title,description:t.description,startDate:t.startDate||"",dueDate:t.dueDate||"",assignedUsers:t.assignedTo||[]}),[u,o]=r.useState([]),[d,m]=r.useState([]);r.useState(t.comments||[]),r.useState(""),r.useState(t.attachments||[]);const[S,b]=r.useState([]),[y,w]=r.useState(!1),D=async()=>{try{const s=await B();o(s.data)}catch(s){console.error("Error fetching users:",s)}};r.useEffect(()=>{D()},[]),r.useEffect(()=>{p&&(L(),D())},[p]),r.useEffect(()=>{const s=u.filter(i=>a.assignedUsers.includes(i._id));m(s)},[u,a.assignedUsers]);const[,k]=I({type:"CARD",item:{cardId:t._id,sourceListId:c}}),L=async()=>{try{const s=await f.get(`/api/boards/${h}/lists/${c}/cards/${t._id}/activity`);b(s.data)}catch(s){console.error("Error fetching activity log:",s)}},U=async()=>{try{await f.put(`${C}/boards/${h}/lists/${c}/cards/${t._id}`,a),n(!1)}catch(s){console.error("Error updating card:",s)}},_=s=>{a.assignedUsers.find(i=>i===s._id)||(l(i=>({...i,assignedUsers:[...i.assignedUsers,s._id]})),w(!1))},A=s=>{l(i=>({...i,assignedUsers:i.assignedUsers.filter(E=>E!==s)}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:k,style:{backgroundColor:"#fff",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",marginBottom:"10px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",position:"relative"},onMouseEnter:s=>s.currentTarget.querySelector("button").style.display="block",onMouseLeave:s=>s.currentTarget.querySelector("button").style.display="none",children:[e.jsx("p",{style:{fontWeight:"normal"},children:t.title}),e.jsx(x,{size:"sm",onClick:()=>n(!0),style:{position:"absolute",top:"10px",right:"10px",fontSize:"12px",display:"none"},children:e.jsx(W,{size:15})})]}),e.jsxs(X,{visible:p,onClose:()=>n(!1),size:"lg",children:[e.jsx(Y,{children:"Edit Card"}),e.jsx(G,{children:e.jsxs("div",{children:[e.jsx(j,{children:"Title"}),e.jsx(v,{type:"text",value:a.title,onChange:s=>l(i=>({...i,title:s.target.value})),className:"mb-3"}),e.jsx(j,{children:"Description"}),e.jsx(M,{value:a.description,onChange:s=>l(i=>({...i,description:s.target.value})),className:"mb-3"}),e.jsx("h6",{children:"Assigned Users"}),e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[d.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginRight:"10px"},children:[e.jsx("span",{style:{backgroundColor:"#ddd",borderRadius:"50%",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"14px",marginRight:"5px"},children:s.username?s.username[0].toUpperCase():""}),e.jsx(z,{style:{cursor:"pointer",color:"red"},onClick:()=>A(s._id)})]},s._id)),e.jsx(P,{style:{cursor:"pointer",fontSize:"20px",color:"#007bff"},onClick:()=>w(!y)})]}),y&&e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",background:"#f8f9fa",padding:"10px",borderRadius:"5px",border:"1px solid #ddd"},children:u.filter(s=>!a.assignedUsers.includes(s._id)).map(s=>e.jsx("div",{style:{display:"flex",alignItems:"center",padding:"8px",borderBottom:"1px solid #ddd",cursor:"pointer",transition:"background-color 0.2s ease"},onClick:()=>_(s),children:e.jsx("span",{children:s.username})},s._id))}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(j,{children:"Start Date"}),e.jsx(v,{type:"datetime-local",value:a.startDate?a.startDate.slice(0,16):"",onChange:s=>l(i=>({...i,startDate:s.target.value})),className:"mb-3"})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(j,{children:"Due Date"}),e.jsx(v,{type:"datetime-local",value:a.dueDate?a.dueDate.slice(0,16):"",onChange:s=>l(i=>({...i,dueDate:s.target.value})),className:"mb-3"})]})]}),e.jsx("h6",{children:"Activity"})]})}),e.jsxs(J,{children:[e.jsx(x,{color:"primary",onClick:U,children:"Save"}),e.jsx(x,{color:"secondary",onClick:()=>n(!1),children:"Close"})]})]})]})};export{de as default};
