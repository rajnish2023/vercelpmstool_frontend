import{r as p,j as e,L as S}from"./index-DgYjAzAV.js";import{d as h}from"./index-DEavITLk.js";import{j as w,k as C,n as T,m as N,i as A}from"./api-CbhHiXfZ.js";import{C as E}from"./CCol-CupnGcp2.js";import{C as v,a as _}from"./CCardBody-beKhoL1g.js";import{C as L}from"./CCardHeader-CwEME8B9.js";import{a as i}from"./CButton-Ds9Im62X.js";const O=()=>{const[u,g]=p.useState([]),[j,f]=p.useState(!0),[x,k]=p.useState(null);p.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("Authentication token is missing.");const r=await w(s);if(r&&r.data)g(r.data);else throw new Error("No tasks found.")}catch(s){k(s.message),console.error("Error fetching tasks:",s)}finally{f(!1)}})()},[]);const c=(t,s)=>{const r=new Date(t),o=new Date,d=r.toISOString().split("T")[0],a=o.toISOString().split("T")[0];return d<a&&s!=="completed"},b=async t=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("Authentication token is missing.");const r=await C(s,t);if(console.log(r.data),r&&r.data)alert("Task marked as today task successfully");else throw new Error("Failed to mark task as today task")}catch(s){console.error("Error marking task as today task:",s),alert("Failed to mark task as today task")}},D=async(t,s)=>{try{const r=localStorage.getItem("token");if(!r)throw new Error("Authentication token is missing.");const o=await T(r,t,s);if(console.log(o.data),o&&o.data)alert("Subtask marked as today task successfully");else throw new Error("Failed to mark subtask as today task")}catch(r){console.error("Error marking subtask as today task:",r),alert("Failed to mark subtask as today task")}},y=async(t,s=null)=>{try{const r=localStorage.getItem("token");if(!r)throw new Error("Authentication token is missing.");if(s){const o=await N(r,t,s);o&&o.data&&(alert("Subtask marked as complete"),g(d=>d.map(a=>{if(a._id===t){const m=a.subtasks.map(l=>(l._id===s&&(l.completed=!0),l)),n=m.every(l=>l.completed);return a.status=n?"completed":"pending",{...a,subtasks:m}}return a})))}else if(u.find(a=>a._id===t).subtasks.every(a=>a.completed)){const a=await A(r,t);a&&a.data&&(alert("Task marked as complete"),g(m=>m.map(n=>(n._id===t&&(n.status="completed",n.subtasks=n.subtasks.map(l=>({...l,completed:!0}))),n))))}else alert("All subtasks must be completed before marking the task as complete.")}catch(r){console.error("Error marking task or subtask as complete:",r),alert("Failed to mark task or subtask as complete")}};return j?e.jsx("p",{children:"Loading..."}):x?e.jsxs("p",{children:["Error: ",x]}):e.jsx(E,{xs:12,children:e.jsxs(v,{className:"mb-4",style:{border:"1px solid #ddd",borderRadius:"10px"},children:[e.jsxs(L,{className:"d-flex justify-content-between align-items-center border-0",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("strong",{className:"fs-4",children:"Your All Tasks"})}),e.jsx(i,{color:"primary",variant:"outline",className:"me-3",children:e.jsx(S,{to:"/today-tasks",style:{textDecoration:"none"},children:"View Today's Tasks"})})]}),e.jsx(_,{children:e.jsx("div",{className:"mt-3",children:u.length>0?e.jsxs("table",{className:"table table-striped table-bordered table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("th",{scope:"col",children:"Project Name"}),e.jsx("th",{scope:"col",children:"Task Title"}),e.jsx("th",{scope:"col",children:"Due Date"}),e.jsx("th",{scope:"col",children:"Priority"}),e.jsx("th",{scope:"col",children:"Status"}),e.jsx("th",{scope:"col",children:"Action"})]})}),e.jsx("tbody",{children:u.map(t=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{style:{fontSize:"13px",backgroundColor:c(t.dueDate,t.status)?"#f8d7da":"transparent"},children:[e.jsx("td",{style:{fontWeight:"bold"},children:t.board.title})," ",e.jsx("td",{children:e.jsx("span",{style:{textDecoration:t.status==="completed"?"line-through":"none",color:c(t.dueDate,t.status)?"red":"inherit"},children:t.title})}),e.jsx("td",{children:t.dueDate?new Date(t.dueDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Not Set"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.priority==="high"?"bg-danger":t.priority==="medium"?"bg-warning":"bg-success"}`,children:t.priority.charAt(0).toUpperCase()+t.priority.slice(1)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.status==="completed"?"bg-success":"bg-danger"}`,children:t.status})}),e.jsxs("td",{children:[t.status!=="completed"&&new Date(t.dueDate).toLocaleDateString("en-GB")!==new Date().toLocaleDateString("en-GB")&&e.jsxs(i,{size:"sm",color:"primary",variant:"outline",onClick:()=>b(t._id),children:[e.jsx(h,{})," Make as Today's Task"]}),t.status!=="completed"&&e.jsxs(i,{size:"sm",color:"success",variant:"outline",onClick:()=>y(t._id),disabled:t.subtasks.some(s=>!s.completed),children:[e.jsx(h,{})," Mark as Complete"]})]})]},t._id),t.subtasks&&t.subtasks.length>0&&t.subtasks.map((s,r)=>e.jsxs("tr",{style:{fontSize:"13px",backgroundColor:c(s.dueDate,s.completed?"completed":"pending")?"#f8d7da":"transparent"},children:[e.jsx("td",{colSpan:"2",className:"ps-5",children:e.jsx("span",{style:{textDecoration:s.completed?"line-through":"none",color:c(s.dueDate,s.completed?"completed":"pending")?"red":"inherit"},children:s.title})}),e.jsx("td",{children:s.dueDate?new Date(s.dueDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Not Set"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.priority==="high"?"bg-danger":s.priority==="medium"?"bg-warning":"bg-success"}`,children:s.priority.charAt(0).toUpperCase()+s.priority.slice(1)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.completed?"bg-success":"bg-danger"}`,children:s.completed?"Completed":"Pending"})}),e.jsxs("td",{children:[s.completed!==!0&&new Date(s.dueDate).toLocaleDateString("en-GB")!==new Date().toLocaleDateString("en-GB")&&e.jsxs(i,{size:"sm",color:"primary",variant:"outline",onClick:()=>D(t._id,s._id),children:[e.jsx(h,{})," Make as Today's Task"]}),s.completed!==!0&&e.jsxs(i,{size:"sm",color:"success",variant:"outline",onClick:()=>y(t._id,s._id),children:[e.jsx(h,{})," Mark as Complete"]})]})]},r))]}))})]}):e.jsx("p",{children:"No tasks available for today"})})})]})})};export{O as default};
