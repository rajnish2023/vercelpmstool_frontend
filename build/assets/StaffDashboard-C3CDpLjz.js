import{r,j as s}from"./index-DgYjAzAV.js";import{z as _,s as B,A as E}from"./api-CbhHiXfZ.js";import{C as T}from"./CFormSelect-DZqGXCr2.js";import{a as U}from"./CButton-Ds9Im62X.js";import"./CFormControlWrapper-CjE6UTdE.js";const P=()=>{const[l,p]=r.useState([]),[x,m]=r.useState([]),[o,j]=r.useState(null),[d,g]=r.useState([]),[f,k]=r.useState(!1),[u,w]=r.useState(null),[h,c]=r.useState(null),i=localStorage.getItem("token"),y=async e=>{try{const t=await _(e);j(t)}catch(t){console.error("Error fetching current user",t),c("Error fetching current user")}},b=async()=>{try{const e=await B();p(e.boards),m(e.users)}catch(e){console.error("Error fetching boards or users",e),c("Error fetching boards or users")}};r.useEffect(()=>{i?(y(i),b()):c("User not authenticated")},[i]);const S=r.useMemo(()=>l.filter(e=>o?e.users.includes(o._id):!1),[l,o]),N=e=>{g(t=>t.includes(e)?t.filter(n=>n!==e):[...t,e])},v=e=>!e||e.length===0?s.jsx("span",{className:"text-muted",children:"No Assignees"}):e.map(t=>{const n=x.find(a=>a._id===t);if(n){const a=n.username;return s.jsxs("span",{className:"badge bg-primary me-2",style:{borderRadius:"50%",padding:"10px"},children:[a.charAt(0).toUpperCase(),a.charAt(a.length-1).toUpperCase()]},t)}return s.jsx("span",{className:"badge bg-secondary me-2",children:"Unknown"},t)}),C=async(e,t)=>{try{await E(e,t),alert("Task status updated successfully")}catch(n){console.error("Error updating task status",n),c("Error updating task status")}},A=e=>s.jsxs("tr",{style:{fontSize:"13px"},children:[s.jsx("td",{children:e.title}),s.jsx("td",{children:v(e.assignees)}),s.jsx("td",{children:e.dueDate?new Date(e.dueDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Not Set"}),s.jsx("td",{children:s.jsx("span",{className:`badge ${e.priority==="high"?"bg-danger":e.priority==="medium"?"bg-warning":"bg-success"}`,children:e.priority.charAt(0).toUpperCase()+e.priority.slice(1)})}),s.jsx("td",{children:s.jsxs(T,{value:e.status,onChange:t=>C(e._id,t.target.value),disabled:e.status==="completed",children:[s.jsx("option",{value:"not_started",children:"Not Started"}),s.jsx("option",{value:"in_progress",children:"In Progress"}),s.jsx("option",{value:"completed",children:"Completed"})]})}),s.jsx("td",{children:s.jsx("div",{className:"d-flex justify-content-around",style:{cursor:"pointer"},children:s.jsx(U,{size:"sm",onClick:()=>console.log("Edit Task",e),children:"..."})})})]},e._id);return s.jsxs("div",{children:[h&&s.jsx("div",{className:"alert alert-danger",role:"alert",children:h}),s.jsx("div",{className:"row",children:S.map(e=>s.jsx("div",{className:"col-md-6 mb-4",children:s.jsxs("div",{className:"border p-2 rounded",style:{border:"1px solid #ddd"},children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center",style:{cursor:"pointer",padding:"10px",borderBottom:"1px solid #ddd"},onClick:()=>N(e._id),children:[s.jsx("span",{className:"h5 mb-0",children:e.title}),s.jsx("span",{style:{fontSize:"20px",opacity:"0.5"},children:d.includes(e._id)?"â–¼":">"})]}),d.includes(e._id)&&s.jsx("div",{className:"mt-3",children:e.tasks&&e.tasks.length>0?s.jsxs("table",{className:"table table-striped table-bordered table-hover",children:[s.jsx("thead",{className:"table-light",children:s.jsxs("tr",{style:{fontSize:"13px"},children:[s.jsx("th",{scope:"col",children:"Title"}),s.jsx("th",{scope:"col",children:"Assignees"}),s.jsx("th",{scope:"col",children:"Due Date"}),s.jsx("th",{scope:"col",children:"Priority"}),s.jsx("th",{scope:"col",children:"Status"}),s.jsx("th",{scope:"col",children:"Action"})]})}),s.jsx("tbody",{children:e.tasks.filter(t=>t.assignees.includes(o._id)).map(A)})]}):s.jsx("div",{className:"text-center",children:"No tasks found"})})]})},e._id))}),f&&u&&s.jsx("div",{children:s.jsxs("h5",{children:["Create Task for Board ID: ",u]})})]})};export{P as default};
