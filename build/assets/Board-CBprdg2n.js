import{r as i,j as e}from"./index-DgYjAzAV.js";import{q as m,b as R}from"./api-CbhHiXfZ.js";import{D as $,H as B,u as F,a as T,C as N}from"./index-CNv7VeAx.js";import{e as I,f as M,b as W}from"./index-DEavITLk.js";import{C as z,a as H}from"./CCardBody-beKhoL1g.js";import{a as x}from"./CButton-Ds9Im62X.js";import{C as P,a as q,b as X,c as Y}from"./CModalHeader-C23ycL_x.js";import{C as y}from"./CFormControlWrapper-CjE6UTdE.js";import{C as b}from"./CFormInput-oMjOEnwC.js";import"./CConditionalPortal-DsNRDAW1.js";const f="http://localhost:5000/api/board",ie=()=>{const[r,h]=i.useState([]),[c,g]=i.useState(""),[p,d]=i.useState(!1),a=async()=>{try{const t=await m.get(f+"/boards");h(t.data.boards)}catch(t){console.error("Error fetching boards:",t)}},n=async t=>{try{await m.post(`${f}/boards/${t}/lists`,{title:c}),g(""),d(!1),a()}catch(l){console.error("Error creating list:",l)}},u=async(t,l,C,v)=>{try{await m.post(`${f}/boards/${t}/lists/${l}/cards/${v}/move`,{targetListId:C}),a()}catch(j){console.error("Error moving card:",j)}};return i.useEffect(()=>{a()},[]),e.jsx($,{backend:B,children:e.jsx("div",{style:{padding:"20px",backgroundColor:"#f8f9fa"},children:e.jsx("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap"},children:r.map(t=>e.jsx(z,{className:"mb-4",style:{width:"100%",backgroundColor:"#fff",borderRadius:"10px",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.1)"},children:e.jsx(H,{children:e.jsxs("div",{style:{display:"flex",overflowX:"auto",gap:"15px"},children:[t.lists.map(l=>e.jsx(G,{list:l,boardId:t._id,moveCard:u},l._id)),e.jsx("div",{children:p?e.jsxs("div",{style:{padding:"15px",minWidth:"250px",maxWidth:"300px",backgroundColor:"#f4f5f7",borderRadius:"5px"},children:[e.jsx("input",{type:"text",value:c,onChange:l=>g(l.target.value),placeholder:"List Title",style:{padding:"8px",fontSize:"14px",width:"100%",marginBottom:"10px",borderRadius:"5px",border:"1px solid #ddd"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(x,{onClick:()=>n(t._id),color:"primary",children:"Add List"}),e.jsx(x,{onClick:()=>d(!1),color:"danger",children:"Cancel"})]})]}):e.jsx(x,{onClick:()=>d(!0),color:"secondary",style:{minWidth:"190px",maxWidth:"190px",padding:"7px",textAlign:"center",backgroundColor:"#007bff",border:"1px transparent",borderRadius:"5px"},children:"Add Another List"})})]})})},t._id))})})})},G=({list:r,boardId:h,moveCard:c})=>{const[g,p]=i.useState(!1),[d,a]=i.useState(""),n=async()=>{if(d.trim())try{await m.post(`${f}/boards/${h}/lists/${r._id}/cards`,{title:d}),a(""),p(!1)}catch(t){console.error("Error adding card:",t)}},[,u]=F({accept:"CARD",drop:t=>{t.sourceListId!==r._id&&c(h,t.sourceListId,r._id,t.cardId)}});return e.jsxs("div",{ref:u,style:{backgroundColor:"#f4f5f7",padding:"15px",borderRadius:"5px",minWidth:"300px",maxWidth:"300px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h6",{style:{marginBottom:"10px"},children:r.title}),e.jsxs("div",{children:[r.cards.map(t=>e.jsx(J,{card:t,boardId:h,listId:r._id,moveCard:c},t._id)),!g&&e.jsx(x,{onClick:()=>p(!0),style:{marginTop:"10px",padding:"8px 16px",fontSize:"14px",fontWeight:"bold"},children:"Add a Card"}),g&&e.jsxs("div",{children:[e.jsx("input",{type:"text",value:d,onChange:t=>a(t.target.value),placeholder:"Card Title",style:{padding:"8px",width:"100%",marginBottom:"10px",borderRadius:"5px",border:"1px solid #ddd"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(x,{onClick:n,color:"primary",children:"Add"}),e.jsx(x,{onClick:()=>p(!1),color:"danger",children:"Cancel"})]})]})]})]})},J=({card:r,boardId:h,listId:c,moveCard:g})=>{const[p,d]=i.useState(!1),[a,n]=i.useState({title:r.title,description:r.description,startDate:r.startDate||"",dueDate:r.dueDate||"",assignedUsers:r.assignedTo||[]}),[u,t]=i.useState([]),[l,C]=i.useState([]);i.useState(r.comments||[]),i.useState(""),i.useState(r.attachments||[]);const[v,j]=i.useState([]),[S,w]=i.useState(!1),D=async()=>{try{const s=await R();t(s.data)}catch(s){console.error("Error fetching users:",s)}};i.useEffect(()=>{D()},[]),i.useEffect(()=>{p&&(L(),D())},[p]),i.useEffect(()=>{const s=u.filter(o=>a.assignedUsers.includes(o._id));C(s)},[u,a.assignedUsers]);const[,k]=T({type:"CARD",item:{cardId:r._id,sourceListId:c}}),L=async()=>{try{const s=await m.get(`/api/boards/${h}/lists/${c}/cards/${r._id}/activity`);j(s.data)}catch(s){console.error("Error fetching activity log:",s)}},U=async()=>{try{await m.put(`${f}/boards/${h}/lists/${c}/cards/${r._id}`,a),d(!1)}catch(s){console.error("Error updating card:",s)}},_=s=>{a.assignedUsers.find(o=>o===s._id)||(n(o=>({...o,assignedUsers:[...o.assignedUsers,s._id]})),w(!1))},A=s=>{n(o=>({...o,assignedUsers:o.assignedUsers.filter(E=>E!==s)}))};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:k,style:{backgroundColor:"#fff",padding:"10px",borderRadius:"5px",border:"1px solid #ddd",marginBottom:"10px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",position:"relative"},onMouseEnter:s=>s.currentTarget.querySelector("button").style.display="block",onMouseLeave:s=>s.currentTarget.querySelector("button").style.display="none",children:[e.jsx("p",{style:{fontWeight:"normal"},children:r.title}),e.jsx(x,{size:"sm",onClick:()=>d(!0),style:{position:"absolute",top:"10px",right:"10px",fontSize:"12px",display:"none"},children:e.jsx(I,{size:15})})]}),e.jsxs(P,{visible:p,onClose:()=>d(!1),size:"lg",children:[e.jsx(q,{children:"Edit Card"}),e.jsx(X,{children:e.jsxs("div",{children:[e.jsx(y,{children:"Title"}),e.jsx(b,{type:"text",value:a.title,onChange:s=>n(o=>({...o,title:s.target.value})),className:"mb-3"}),e.jsx(y,{children:"Description"}),e.jsx(N,{value:a.description,onChange:s=>n(o=>({...o,description:s.target.value})),className:"mb-3"}),e.jsx("h6",{children:"Assigned Users"}),e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[l.map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",marginRight:"10px"},children:[e.jsx("span",{style:{backgroundColor:"#ddd",borderRadius:"50%",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"14px",marginRight:"5px"},children:s.username?s.username[0].toUpperCase():""}),e.jsx(M,{style:{cursor:"pointer",color:"red"},onClick:()=>A(s._id)})]},s._id)),e.jsx(W,{style:{cursor:"pointer",fontSize:"20px",color:"#007bff"},onClick:()=>w(!S)})]}),S&&e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",background:"#f8f9fa",padding:"10px",borderRadius:"5px",border:"1px solid #ddd"},children:u.filter(s=>!a.assignedUsers.includes(s._id)).map(s=>e.jsx("div",{style:{display:"flex",alignItems:"center",padding:"8px",borderBottom:"1px solid #ddd",cursor:"pointer",transition:"background-color 0.2s ease"},onClick:()=>_(s),children:e.jsx("span",{children:s.username})},s._id))}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6",children:[e.jsx(y,{children:"Start Date"}),e.jsx(b,{type:"datetime-local",value:a.startDate?a.startDate.slice(0,16):"",onChange:s=>n(o=>({...o,startDate:s.target.value})),className:"mb-3"})]}),e.jsxs("div",{className:"col-6",children:[e.jsx(y,{children:"Due Date"}),e.jsx(b,{type:"datetime-local",value:a.dueDate?a.dueDate.slice(0,16):"",onChange:s=>n(o=>({...o,dueDate:s.target.value})),className:"mb-3"})]})]}),e.jsx("h6",{children:"Activity"})]})}),e.jsxs(Y,{children:[e.jsx(x,{color:"primary",onClick:U,children:"Save"}),e.jsx(x,{color:"secondary",onClick:()=>d(!1),children:"Close"})]})]})]})};export{ie as default};
