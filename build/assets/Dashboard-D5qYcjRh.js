import{r as l,_ as Ae,R as ue,a as Ue,c as Me,P as h,b as Pe,j as e,L as Re}from"./index-DgYjAzAV.js";import{g as ze,a as Le,b as Fe,c as He,U as Ve,d as $e,e as Ke,u as Oe}from"./api-CbhHiXfZ.js";import{F as We,a as Ye,b as Ge}from"./index-DEavITLk.js";import{C as Ie}from"./CRow-CkTnp1v3.js";import{C as fe}from"./CCol-CupnGcp2.js";import{C as qe,a as be}from"./CCardBody-beKhoL1g.js";import{C as Je}from"./CCardHeader-CwEME8B9.js";import{a as o}from"./CButton-Ds9Im62X.js";import{C as Qe}from"./CInputGroup-99dEA3AI.js";import{C as y}from"./CFormInput-oMjOEnwC.js";import{C as Xe,a as Z}from"./CModalTitle-EVfRvZwH.js";import{C as ee,a as se,b as te,c as ae}from"./CModalHeader-C23ycL_x.js";import{u as Ze,T as es,b as re}from"./CConditionalPortal-DsNRDAW1.js";import"./CFormControlWrapper-CjE6UTdE.js";var ss=l.createContext({}),le=l.forwardRef(function(n,f){var P=n.children,R=n.animation,b=R===void 0?!0:R,p=n.autohide,T=p===void 0?!0:p,v=n.className,w=n.color,u=n.delay,ie=u===void 0?5e3:u,m=n.index,ne=n.innerKey,C=n.visible,c=C===void 0?!1:C,z=n.onClose,L=n.onShow,oe=Ae(n,["children","animation","autohide","className","color","delay","index","innerKey","visible","onClose","onShow"]),F=l.useRef(),H=Ze(f,F),S=l.useState(!1),_=S[0],B=S[1],j=l.useRef();l.useEffect(function(){B(c)},[c]);var ce={visible:_,setVisible:B};l.useEffect(function(){return function(){return clearTimeout(j.current)}},[]),l.useEffect(function(){N()},[_]);var N=function(){T&&(clearTimeout(j.current),j.current=window.setTimeout(function(){B(!1)},ie))};return ue.createElement(es,{in:_,nodeRef:F,onEnter:function(){return L&&L(m??null)},onExited:function(){return z&&z(m??null)},timeout:250,unmountOnExit:!0},function(x){var d;return ue.createElement(ss.Provider,{value:ce},ue.createElement("div",Ue({className:Me("toast",(d={fade:b},d["bg-".concat(w)]=w,d["border-0"]=w,d["show showing"]=x==="entering"||x==="exiting",d.show=x==="entered",d),v),"aria-live":"assertive","aria-atomic":"true",role:"alert",onMouseEnter:function(){return clearTimeout(j.current)},onMouseLeave:function(){return N()}},oe,{key:ne,ref:H}),P))})});le.propTypes={animation:h.bool,autohide:h.bool,children:h.node,className:h.string,color:Pe,delay:h.number,index:h.number,innerKey:h.oneOfType([h.number,h.string]),onClose:h.func,onShow:h.func,visible:h.bool};le.displayName="CToast";const js=()=>{var je,ge;const[n,f]=l.useState([]),[P,R]=l.useState(""),[b,p]=l.useState(""),[T,v]=l.useState([]),[w,u]=l.useState(null),[ie,m]=l.useState(!1),[ne,C]=l.useState(!1),[c,z]=l.useState([]),[L,oe]=l.useState({}),[F,H]=l.useState(null),[S,_]=l.useState(null),[B,j]=l.useState(!1),[ce,N]=l.useState(!1),[x,d]=l.useState(""),[V,A]=l.useState(""),[$,K]=l.useState([]),[D,U]=l.useState(""),[O,M]=l.useState("medium"),[g,me]=l.useState(null),[W,xe]=l.useState(null),k=localStorage.getItem("token"),[E,Y]=l.useState([]),G=(s,t,a)=>{if(t==="dueDate"){const i=new Date(D);if(new Date(a)>i){alert("Subtask's due date must be earlier than the task's due date.");return}}const r=[...E];r[s][t]=a,Y(r)},ye=()=>{Y([...E,{title:"",assignedTo:"",priority:"low",dueDate:"",completed:!1}])},ve=s=>{const t=E.filter((a,r)=>r!==s);Y(t)},Ce=async()=>{try{const s=await ze(k);oe(s.data)}catch(s){console.error("Error fetching user details",s)}},de=async()=>{try{const s=await Le(k);Array.isArray(s.data)?(f(s.data),s.data.forEach(t=>he(t._id))):u("Unexpected data format. Boards should be an array.")}catch(s){u("Error fetching boards. Please try again later."),console.error("Error fetching boards",s)}},Ne=async()=>{try{const s=await Fe();Array.isArray(s.data)?z(s.data):u("Unexpected data format. Users should be an array.")}catch(s){u("Error fetching users. Please try again later."),console.error("Error fetching users",s)}},ke=async()=>{try{const s=await He(k,{title:b,slug:b.toLowerCase().replace(/\s+/g,"-"),users:T});f([...n,s.data]),p(""),v([]),m(!1),de(),H(e.jsx(le,{visible:!0,color:"success",autohide:3e3,children:"Board created successfully!"}))}catch(s){u("Error creating board. Please try again later."),console.error("Error creating board",s)}},Te=async()=>{try{if(!S)return;const s=await Ve(k,S._id,{title:b,slug:b.toLowerCase().replace(/\s+/g,"-"),users:T});f(t=>t.map(a=>a._id===S._id?s.data:a)),p(""),v([]),C(!1),de(),H(e.jsx(le,{visible:!0,color:"success",autohide:3e3,children:"Board updated successfully!"}))}catch(s){u("Error updating board. Please try again later."),console.error("Error updating board",s)}},he=async s=>{try{const a=(await $e(k,s)).data;f(r=>r.map(i=>i._id===s?{...i,tasks:a}:i))}catch(t){console.error("Error fetching tasks",t)}},we=async()=>{if(!x||!g)return;const s={title:x,description:V,assignees:$,dueDate:D,priority:O};try{const a=(await Ke(k,g,s)).data;f(r=>r.map(i=>i._id===g?{...i,tasks:a}:i)),he(g),d(""),A(""),U(""),M("medium"),K([]),j(!1)}catch(t){u("Error creating task. Please try again later."),console.error("Error creating task",t)}},Se=s=>{me(s.board),xe(s),d(s.title),A(s.description),U(s.dueDate||""),M(s.priority),K(s.assignees),N(!0),Y(s.subtasks||[])},I=s=>{K(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},De=async()=>{if(console.log(W._id),!x||!W)return;const s={title:x,description:V,assignees:$,dueDate:D,priority:O,subtasks:E};try{const t=await Oe(k,W._id,s);f(a=>a.map(r=>r._id===g?{...r,tasks:r.tasks.map(i=>i._id===W._id?t.data.task:i)}:r)),he(g),N(!1),xe(null)}catch(t){u("Error editing task. Please try again later."),console.error("Error editing task",t)}},Ee=s=>{me(s),d(""),A(""),U(""),M("medium"),K([])};l.useEffect(()=>{de(),Ne(),Ce()},[]);const pe=n.filter(s=>{var t;return(t=s.title)==null?void 0:t.toLowerCase().includes(P.toLowerCase())}),q=s=>s.username.split(" ").map(t=>t[0]).join("").toUpperCase(),J=()=>{const s=["#007bff"];return s[Math.floor(Math.random()*s.length)]},Q=s=>{v(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},_e=s=>{_(s),p(s.title),v(s.users.map(t=>t)),C(!0)};return e.jsxs(Ie,{children:[e.jsx(fe,{xs:12,children:e.jsxs(qe,{className:"mb-4",style:{border:"1px solid #ddd",borderRadius:"10px"},children:[e.jsxs(Je,{className:"d-flex justify-content-between align-items-center border-0",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("strong",{className:"fs-4",children:"Boards"})}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(o,{color:"warning",className:"me-3",variant:"outline",children:e.jsx(Re,{to:"/today-tasks",style:{textDecoration:"none"},children:"Today Tasks"})}),L.role==="2"&&e.jsx(o,{color:"primary",variant:"outline",className:"me-3",onClick:()=>{p(""),v([]),m(!0)},children:"Create Board"}),e.jsx(Qe,{style:{width:"250px"},className:"rounded-pill",children:e.jsx(y,{placeholder:"Search for boards...",value:P,onChange:s=>R(s.target.value),className:"rounded-pill"})})]})]}),e.jsxs(be,{children:[w&&e.jsx(Xe,{color:"danger",children:w}),pe.length>0?e.jsx("div",{className:"row",children:pe.map(s=>e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"border p-2 rounded",style:{border:"1px solid #ddd"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",style:{padding:"10px",borderBottom:"1px solid #ddd"},children:[e.jsx("span",{className:"h5 mb-0",children:s.title}),e.jsx(o,{size:"sm",color:"primary",variant:"outline",onClick:()=>_e(s),children:"Edit"})]}),e.jsxs("div",{className:"mt-3",children:[s.tasks&&s.tasks.length>0?e.jsxs("table",{className:"table table-striped table-bordered table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("th",{scope:"col",children:"Title"}),e.jsx("th",{scope:"col",children:"Assignees"}),e.jsx("th",{scope:"col",children:"Due Date"}),e.jsx("th",{scope:"col",children:"Priority"}),e.jsx("th",{scope:"col",children:"Action"})]})}),e.jsx("tbody",{children:s.tasks.map(t=>e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("td",{children:t.title}),e.jsx("td",{children:t.assignees&&t.assignees.length>0?t.assignees.map(a=>{const r=c.find(i=>i._id===a);if(r){const i=r.username,X=i.charAt(0).toUpperCase(),Be=i.charAt(i.length-1).toUpperCase();return e.jsxs("span",{className:"badge bg-primary me-2",style:{borderRadius:"50%",padding:"10px"},children:[X,Be]},a)}return e.jsx("span",{className:"badge bg-secondary me-2",children:"Unknown"},a)}):e.jsx("span",{className:"text-muted",children:"No Assignees"})}),e.jsx("td",{children:t.dueDate?new Date(t.dueDate).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"Not Set"}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.priority==="high"?"bg-danger":t.priority==="medium"?"bg-warning":"bg-success"}`,children:t.priority.charAt(0).toUpperCase()+t.priority.slice(1)})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-around",style:{cursor:"pointer"},children:e.jsx(o,{size:"sm",onClick:()=>Se(t),children:e.jsx(We,{})})})})]},t._id))})]}):e.jsx("div",{className:"text-center",children:"No tasks found"}),e.jsx(o,{color:"primary",variant:"outline",size:"sm",onClick:()=>{Ee(s._id),j(!0)},children:"Create Task"})]})]})},s._id))}):e.jsx(fe,{children:e.jsx(be,{className:"text-center",children:e.jsx("h5",{children:"No boards found"})})})]})]})}),e.jsxs(ee,{visible:ie,onClose:()=>m(!1),className:"rounded-3",children:[e.jsx(se,{className:"border-0",children:e.jsx(Z,{children:"Create Board"})}),e.jsxs(te,{children:[e.jsx(y,{value:b,onChange:s=>p(s.target.value),placeholder:"Board Title",className:"mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Select Users"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",paddingRight:"10px"},children:c.map(s=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"position-relative",children:e.jsx(re,{size:"sm",className:"me-2",style:{backgroundColor:J(),cursor:"pointer",color:"white"},onClick:()=>Q(s._id),children:q(s)})}),e.jsx("span",{onClick:()=>Q(s._id),className:`text-truncate ${T.includes(s._id)?"fw-bold":""}`,style:{maxWidth:"120px",cursor:"pointer"},children:s.username})]},s._id))})]})]}),e.jsxs(ae,{children:[e.jsx(o,{color:"primary",onClick:ke,className:"rounded-pill",children:"Create"}),e.jsx(o,{color:"secondary",onClick:()=>m(!1),className:"rounded-pill",children:"Cancel"})]})]}),e.jsxs(ee,{visible:ne,onClose:()=>C(!1),className:"rounded-3",children:[e.jsx(se,{className:"border-0",children:e.jsx(Z,{children:"Edit Board"})}),e.jsxs(te,{children:[e.jsx(y,{value:b,onChange:s=>p(s.target.value),placeholder:"Board Title",className:"mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Select Users"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto",paddingRight:"10px"},children:c.map(s=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"position-relative",children:e.jsx(re,{size:"sm",className:"me-2",style:{backgroundColor:J(),cursor:"pointer",color:"white"},onClick:()=>Q(s._id),children:q(s)})}),e.jsx("span",{onClick:()=>Q(s._id),className:`text-truncate ${T.includes(s._id)?"fw-bold":""}`,style:{maxWidth:"120px",cursor:"pointer"},children:s.username})]},s._id))})]})]}),e.jsxs(ae,{children:[e.jsx(o,{color:"primary",onClick:Te,className:"rounded-pill",children:"Update"}),e.jsx(o,{color:"secondary",onClick:()=>C(!1),className:"rounded-pill",children:"Cancel"})]})]}),e.jsxs(ee,{visible:B,onClose:()=>j(!1),className:"rounded-3",size:"lg",children:[e.jsx(se,{className:"border-0",children:e.jsx(Z,{children:"Create Task"})}),e.jsxs(te,{children:[e.jsx("strong",{children:"Task"}),e.jsx(y,{placeholder:"Task Title",value:x,onChange:s=>d(s.target.value),className:"mb-3"}),e.jsx("strong",{children:"Description"}),e.jsx("textarea",{placeholder:"Task Description",value:V,onChange:s=>A(s.target.value),className:"form-control mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Assignees"}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:(je=n.find(s=>s._id===g))==null?void 0:je.users.map(s=>{var t;return e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"position-relative",children:e.jsx(re,{size:"sm",className:"me-2",style:{backgroundColor:J(),cursor:"pointer",color:"white"},onClick:()=>I(s),children:q(c.find(a=>a._id===s))})}),e.jsx("span",{onClick:()=>I(s),className:`text-truncate ${$.includes(s)?"fw-bold":""}`,style:{maxWidth:"120px",cursor:"pointer"},children:(t=c.find(a=>a._id===s))==null?void 0:t.username})]},s)})})]}),e.jsx("strong",{children:"Due Date"}),e.jsx(y,{type:"datetime-local",value:D,onChange:s=>U(s.target.value),className:"mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Priority"}),e.jsxs("select",{className:"form-select",value:O,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs(ae,{children:[e.jsx(o,{color:"primary",onClick:we,className:"rounded-pill",children:"Create Task"}),e.jsx(o,{color:"secondary",onClick:()=>j(!1),className:"rounded-pill",children:"Cancel"})]})]}),e.jsxs(ee,{visible:ce,onClose:()=>N(!1),className:"rounded-3",backdrop:"static",size:"xl",children:[e.jsx(se,{className:"border-0",children:e.jsx(Z,{children:"Edit Task"})}),e.jsxs(te,{children:[e.jsx("strong",{children:"Task"}),e.jsx(y,{placeholder:"Task Title",value:x,onChange:s=>d(s.target.value),className:"mb-3"}),e.jsx("strong",{children:"Description"}),e.jsx("textarea",{placeholder:"Task Description",value:V,onChange:s=>A(s.target.value),className:"form-control mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Assignees"}),e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto"},children:(ge=n.find(s=>s._id===g))==null?void 0:ge.users.map(s=>{var t;return e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(re,{size:"sm",className:"me-2",style:{backgroundColor:J(),cursor:"pointer",color:"white"},onClick:()=>I(c.find(a=>a._id===s)),children:q(c.find(a=>a._id===s))}),e.jsx("span",{onClick:()=>I(s),className:`text-truncate ${$.includes(s)?"fw-bold":""}`,style:{maxWidth:"120px",cursor:"pointer"},children:(t=c.find(a=>a._id===s))==null?void 0:t.username})]},s)})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Subtasks"}),e.jsxs("div",{className:"mb-4",children:[E.length>0?e.jsxs("table",{className:"table table-striped table-bordered table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("th",{scope:"col",children:"Title"}),e.jsx("th",{scope:"col",children:"Assignee"}),e.jsx("th",{scope:"col",children:"Due Date"}),e.jsx("th",{scope:"col",children:"Priority"}),e.jsx("th",{scope:"col",children:"Action"})]})}),e.jsx("tbody",{children:E.map((s,t)=>{var a;return e.jsxs("tr",{style:{fontSize:"13px"},children:[e.jsx("td",{children:e.jsx("input",{type:"text",placeholder:"Subtask Title",value:s.title,onChange:r=>G(t,"title",r.target.value),className:`form-control ${s.completed?"text-decoration-line-through":""}`,disabled:s.completed})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select",value:s.assignedTo||"",onChange:r=>G(t,"assignedTo",r.target.value),disabled:s.completed,children:[e.jsx("option",{value:"",children:"Assign User"}),(a=n.find(r=>r._id===g))==null?void 0:a.users.map(r=>{var i;return e.jsx("option",{value:r,children:(i=c.find(X=>X._id===r))==null?void 0:i.username},r)})]})}),e.jsx("td",{children:e.jsx(y,{type:"datetime-local",value:s.dueDate?new Date(s.dueDate).toISOString().slice(0,16):"",onChange:r=>G(t,"dueDate",r.target.value),disabled:s.completed})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select",value:s.priority,onChange:r=>G(t,"priority",r.target.value),disabled:s.completed,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})}),e.jsx("td",{children:e.jsx("div",{className:"d-flex justify-content-around",style:{cursor:"pointer"},children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>ve(t),children:e.jsx(Ye,{})})})})]},t)})})]}):e.jsx("p",{className:"text-muted",children:"No subtasks added yet."}),e.jsxs("button",{type:"button",className:"btn btn-link p-0 mt-3",onClick:ye,children:[e.jsx(Ge,{})," Add Subtask"]})]})]}),e.jsx("strong",{children:"Due Date"}),e.jsx(y,{type:"datetime-local",value:D?new Date(D).toISOString().slice(0,16):"",onChange:s=>U(s.target.value),className:"mb-3"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Priority"}),e.jsxs("select",{className:"form-select",value:O,onChange:s=>M(s.target.value),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]})]}),e.jsxs(ae,{children:[e.jsx(o,{color:"primary",onClick:De,className:"rounded-pill",children:"Save Changes"}),e.jsx(o,{color:"secondary",onClick:()=>N(!1),className:"rounded-pill",children:"Cancel"})]})]}),F]})};export{js as default};
